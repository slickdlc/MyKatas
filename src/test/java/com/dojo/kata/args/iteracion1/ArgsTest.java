package com.dojo.kata.args.iteracion1;

import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.io.ByteArrayOutputStream;
import java.io.PrintStream;

import static org.junit.jupiter.api.Assertions.*;

class ArgsTest {

    private static final String EXPECTED_PRINT_WITHOUT_ARGS = "123456789101112131415161718192021222324252627282930313" +
            "2333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848" +
            "58687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125" +
            "12612712812913013113213313413513613713813914014114214314414514614714814915015115215315415515615715815916016" +
            "11621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961" +
            "97198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232" +
            "23323423523623723823924024124224324424524624724824925025125225325425525625725825926026126226326426526626726" +
            "826927027127227327427527627727827928028128228328428528628728828929029129229329429529629729829930030130230330" +
            "4305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340" +
            "3413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763" +
            "7737837938038138238338438538638738838939039139239339439539639739839940040140240340440540640740840941041141241" +
            "341441541641741841942042142242342442542642742842943043143243343443543643743843944044144244344444544644744844" +
            "9450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485" +
            "4864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215" +
            "2252352452552652752852953053153253353453553653753853954054154254354454554654754854955055155255355455555655755" +
            "8559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594" +
            "59559659759859960060160260360460560660760860961061161261361461561661761861962062162262362462562662762862963063" +
            "163263363463563663763863964064164264364464564664764864965065165265365465565665765865966066166266366466566666" +
            "766866967067167267367467567667767867968068168268368468568668768868969069169269369469569669769869970070170270" +
            "370470570670770870971071171271371471571671771871972072172272372472572672772872973073173273373473573673773873" +
            "974074174274374474574674774874975075175275375475575675775875976076176276376476576676776876977077177277377477" +
            "577677777877978078178278378478578678778878979079179279379479579679779879980080180280380480580680780880981081" +
            "18128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468" +
            "47848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882" +
            "88388488588688788888989089189289389489589689789889990090190290390490590690790890991091191291391491591691791" +
            "89199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539" +
            "54955956957958959960961962963964965966967968969970971972973974975976977978979980981982983984985986987988989" +
            "9909919929939949959969979989991000";
    private static final String EVEN_STRING_VALUES = "246810121416182022242628303234363840424446485052545658606264666870" +
            "72747678808284868890929496981001021041061081101121141161181201221241261281301321341361381401421441461481501" +
            "52154156158160162164166168170172174176178180182184186188190192194196198200202204206208210212214216218220222" +
            "22422622823023223423623824024224424624825025225425625826026226426626827027227427627828028228428628829029229" +
            "42962983003023043063083103123143163183203223243263283303323343363383403423443463483503523543563583603623643" +
            "66368370372374376378380382384386388390392394396398400402404406408410412414416418420422424426428430432434436" +
            "4384404424444464484504524544564584604624644664684704724744764784804824844864884904924944964985005025045065" +
            "08510512514516518520522524526528530532534536538540542544546548550552554556558560562564566568570572574576578" +
            "58058258458658859059259459659860060260460660861061261461661862062262462662863063263463663864064264464664865" +
            "06526546566586606626646666686706726746766786806826846866886906926946966987007027047067087107127147167187207" +
            "22724726728730732734736738740742744746748750752754756758760762764766768770772774776778780782784786788790792" +
            "794796798800802804806808810812814816818820822824826828830832834836838840842844846848850852854856858860862864" +
            "86686887087287487687888088288488688889089289489689890090290490690891091291491691892092292492692893093293493" +
            "69389409429449469489509529549569589609629649669689709729749769789809829849869889909929949969981000";
    private static final String ODD_STRING_VALUES = "1357911131517192123252729313335373941434547495153555759616365676971737577" +
            "79818385878991939597991011031051071091111131151171191211231251271291311331351371391411431451471491511531551571591" +
            "6116316516716917117317517717918118318518718919119319519719920120320520720921121321521721922122322522722923123323" +
            "5237239241243245247249251253255257259261263265267269271273275277279281283285287289291293295297299301303305307309" +
            "3113133153173193213233253273293313333353373393413433453473493513533553573593613633653673693713733753773793813833" +
            "8538738939139339539739940140340540740941141341541741942142342542742943143343543743944144344544744945145345545745" +
            "9461463465467469471473475477479481483485487489491493495497499501503505507509511513515517519521523525527529531533" +
            "535537539541543545547549551553555557559561563565567569571573575577579581583585587589591593595597599601603605607" +
            "609611613615617619621623625627629631633635637639641643645647649651653655657659661663665667669671673675677679681" +
            "6836856876896916936956976997017037057077097117137157177197217237257277297317337357377397417437457477497517537557" +
            "5775976176376576776977177377577777978178378578778979179379579779980180380580780981181381581781982182382582782983" +
            "1833835837839841843845847849851853855857859861863865867869871873875877879881883885887889891893895897899901903905" +
            "9079099119139159179199219239259279299319339359379399419439459479499519539559579599619639659679699719739759779799" +
            "81983985987989991993995997999";

    private static final String NUMBERS_500_TO_1000 = "50050150250350450550650750850951051151251351451551651751851952052152252" +
            "35245255265275285295305315325335345355365375385395405415425435445455465475485495" +
            "505515525535545555565575585595605615625635645655665675685695705715725735745755" +
            "765775785795805815825835845855865875885895905915925935945955965975985996006016" +
            "0260360460560660760860961061161261361461561661761861962062162262362462562662762" +
            "862963063163263363463563663763863964064164264364464564664764864965065165265365" +
            "465565665765865966066166266366466566666766866967067167267367467567667767867968" +
            "068168268368468568668768868969069169269369469569669769869970070170270370470570" +
            "670770870971071171271371471571671771871972072172272372472572672772872973073173" +
            "273373473573673773873974074174274374474574674774874975075175275375475575675775" +
            "875976076176276376476576676776876977077177277377477577677777877978078178278378" +
            "478578678778878979079179279379479579679779879980080180280380480580680780880981" +
            "081181281381481581681781881982082182282382482582682782882983083183283383483583" +
            "683783883984084184284384484584684784884985085185285385485585685785885986086186" +
            "286386486586686786886987087187287387487587687787887988088188288388488588688788" +
            "888989089189289389489589689789889990090190290390490590690790890991091191291391" +
            "491591691791891992092192292392492592692792892993093193293393493593693793893994" +
            "094194294394494594694794894995095195295395495595695795895996096196296396496596" +
            "696796896997097197297397497597697797897998098198298398498598698798898999099199" +
            "29939949959969979989991000";
    private static final String NUMBERS_1_TO_30 = "12345678910111213141516171819202122" +
            "2324252627282930";

    private static final String NUMBERS_20_TO_30 = "202122" +
            "2324252627282930";

    private static final String NUMBERS_1_TO_1000_WITH_PREFIX = ".1.2.3.4.5.6.7.8.9.10.11." +
            "12.13.14.15.16.17.18.19.20.21.22.23.24.25.26.27.28.29.30.31.32.33.34.35.36.3" +
            "7.38.39.40.41.42.43.44.45.46.47.48.49.50.51.52.53.54.55.56.57.58.59.60.61.62." +
            "63.64.65.66.67.68.69.70.71.72.73.74.75.76.77.78.79.80.81.82.83.84.85.86.87.88" +
            ".89.90.91.92.93.94.95.96.97.98.99.100.101.102.103.104.105.106.107.108.109.110" +
            ".111.112.113.114.115.116.117.118.119.120.121.122.123.124.125.126.127.128.12" +
            "9.130.131.132.133.134.135.136.137.138.139.140.141.142.143.144.145.146.147.148" +
            ".149.150.151.152.153.154.155.156.157.158.159.160.161.162.163.164.165.166.16" +
            "7.168.169.170.171.172.173.174.175.176.177.178.179.180.181.182.183.184.185.1" +
            "86.187.188.189.190.191.192.193.194.195.196.197.198.199.200.201.202.203.204." +
            "205.206.207.208.209.210.211.212.213.214.215.216.217.218.219.220.221.222.223" +
            ".224.225.226.227.228.229.230.231.232.233.234.235.236.237.238.239.240.241.24" +
            "2.243.244.245.246.247.248.249.250.251.252.253.254.255.256.257.258.259.260.2" +
            "61.262.263.264.265.266.267.268.269.270.271.272.273.274.275.276.277.278.279." +
            "280.281.282.283.284.285.286.287.288.289.290.291.292.293.294.295.296.297.298" +
            ".299.300.301.302.303.304.305.306.307.308.309.310.311.312.313.314.315.316.31" +
            "7.318.319.320.321.322.323.324.325.326.327.328.329.330.331.332.333.334.335.3" +
            "36.337.338.339.340.341.342.343.344.345.346.347.348.349.350.351.352.353.354." +
            "355.356.357.358.359.360.361.362.363.364.365.366.367.368.369.370.371.372.373" +
            ".374.375.376.377.378.379.380.381.382.383.384.385.386.387.388.389.390.391.39" +
            "2.393.394.395.396.397.398.399.400.401.402.403.404.405.406.407.408.409.410.4" +
            "11.412.413.414.415.416.417.418.419.420.421.422.423.424.425.426.427.428.429." +
            "430.431.432.433.434.435.436.437.438.439.440.441.442.443.444.445.446.447.448" +
            ".449.450.451.452.453.454.455.456.457.458.459.460.461.462.463.464.465.466.46" +
            "7.468.469.470.471.472.473.474.475.476.477.478.479.480.481.482.483.484.485.4" +
            "86.487.488.489.490.491.492.493.494.495.496.497.498.499.500.501.502.503.504." +
            "505.506.507.508.509.510.511.512.513.514.515.516.517.518.519.520.521.522.523" +
            ".524.525.526.527.528.529.530.531.532.533.534.535.536.537.538.539.540.541.54" +
            "2.543.544.545.546.547.548.549.550.551.552.553.554.555.556.557.558.559.560.5" +
            "61.562.563.564.565.566.567.568.569.570.571.572.573.574.575.576.577.578.579." +
            "580.581.582.583.584.585.586.587.588.589.590.591.592.593.594.595.596.597.598" +
            ".599.600.601.602.603.604.605.606.607.608.609.610.611.612.613.614.615.616.61" +
            "7.618.619.620.621.622.623.624.625.626.627.628.629.630.631.632.633.634.635.6" +
            "36.637.638.639.640.641.642.643.644.645.646.647.648.649.650.651.652.653.654." +
            "655.656.657.658.659.660.661.662.663.664.665.666.667.668.669.670.671.672.673" +
            ".674.675.676.677.678.679.680.681.682.683.684.685.686.687.688.689.690.691.69" +
            "2.693.694.695.696.697.698.699.700.701.702.703.704.705.706.707.708.709.710.7" +
            "11.712.713.714.715.716.717.718.719.720.721.722.723.724.725.726.727.728.729." +
            "730.731.732.733.734.735.736.737.738.739.740.741.742.743.744.745.746.747.748" +
            ".749.750.751.752.753.754.755.756.757.758.759.760.761.762.763.764.765.766.76" +
            "7.768.769.770.771.772.773.774.775.776.777.778.779.780.781.782.783.784.785.7" +
            "86.787.788.789.790.791.792.793.794.795.796.797.798.799.800.801.802.803.804." +
            "805.806.807.808.809.810.811.812.813.814.815.816.817.818.819.820.821.822.823" +
            ".824.825.826.827.828.829.830.831.832.833.834.835.836.837.838.839.840.841.84" +
            "2.843.844.845.846.847.848.849.850.851.852.853.854.855.856.857.858.859.860.8" +
            "61.862.863.864.865.866.867.868.869.870.871.872.873.874.875.876.877.878.879." +
            "880.881.882.883.884.885.886.887.888.889.890.891.892.893.894.895.896.897.898" +
            ".899.900.901.902.903.904.905.906.907.908.909.910.911.912.913.914.915.916.91" +
            "7.918.919.920.921.922.923.924.925.926.927.928.929.930.931.932.933.934.935.9" +
            "36.937.938.939.940.941.942.943.944.945.946.947.948.949.950.951.952.953.954." +
            "955.956.957.958.959.960.961.962.963.964.965.966.967.968.969.970.971.972.973" +
            ".974.975.976.977.978.979.980.981.982.983.984.985.986.987.988.989.990.991.99" +
            "2.993.994.995.996.997.998.999.1000";

    private static final String NUMBERS_1_TO_1000_WITH_SUFFIX = "1.2.3.4.5.6.7.8.9.10.11." +
            "12.13.14.15.16.17.18.19.20.21.22.23.24.25.26.27.28.29.30.31.32.33.34.35.36.3" +
            "7.38.39.40.41.42.43.44.45.46.47.48.49.50.51.52.53.54.55.56.57.58.59.60.61.62." +
            "63.64.65.66.67.68.69.70.71.72.73.74.75.76.77.78.79.80.81.82.83.84.85.86.87.88" +
            ".89.90.91.92.93.94.95.96.97.98.99.100.101.102.103.104.105.106.107.108.109.110" +
            ".111.112.113.114.115.116.117.118.119.120.121.122.123.124.125.126.127.128.12" +
            "9.130.131.132.133.134.135.136.137.138.139.140.141.142.143.144.145.146.147.148" +
            ".149.150.151.152.153.154.155.156.157.158.159.160.161.162.163.164.165.166.16" +
            "7.168.169.170.171.172.173.174.175.176.177.178.179.180.181.182.183.184.185.1" +
            "86.187.188.189.190.191.192.193.194.195.196.197.198.199.200.201.202.203.204." +
            "205.206.207.208.209.210.211.212.213.214.215.216.217.218.219.220.221.222.223" +
            ".224.225.226.227.228.229.230.231.232.233.234.235.236.237.238.239.240.241.24" +
            "2.243.244.245.246.247.248.249.250.251.252.253.254.255.256.257.258.259.260.2" +
            "61.262.263.264.265.266.267.268.269.270.271.272.273.274.275.276.277.278.279." +
            "280.281.282.283.284.285.286.287.288.289.290.291.292.293.294.295.296.297.298" +
            ".299.300.301.302.303.304.305.306.307.308.309.310.311.312.313.314.315.316.31" +
            "7.318.319.320.321.322.323.324.325.326.327.328.329.330.331.332.333.334.335.3" +
            "36.337.338.339.340.341.342.343.344.345.346.347.348.349.350.351.352.353.354." +
            "355.356.357.358.359.360.361.362.363.364.365.366.367.368.369.370.371.372.373" +
            ".374.375.376.377.378.379.380.381.382.383.384.385.386.387.388.389.390.391.39" +
            "2.393.394.395.396.397.398.399.400.401.402.403.404.405.406.407.408.409.410.4" +
            "11.412.413.414.415.416.417.418.419.420.421.422.423.424.425.426.427.428.429." +
            "430.431.432.433.434.435.436.437.438.439.440.441.442.443.444.445.446.447.448" +
            ".449.450.451.452.453.454.455.456.457.458.459.460.461.462.463.464.465.466.46" +
            "7.468.469.470.471.472.473.474.475.476.477.478.479.480.481.482.483.484.485.4" +
            "86.487.488.489.490.491.492.493.494.495.496.497.498.499.500.501.502.503.504." +
            "505.506.507.508.509.510.511.512.513.514.515.516.517.518.519.520.521.522.523" +
            ".524.525.526.527.528.529.530.531.532.533.534.535.536.537.538.539.540.541.54" +
            "2.543.544.545.546.547.548.549.550.551.552.553.554.555.556.557.558.559.560.5" +
            "61.562.563.564.565.566.567.568.569.570.571.572.573.574.575.576.577.578.579." +
            "580.581.582.583.584.585.586.587.588.589.590.591.592.593.594.595.596.597.598" +
            ".599.600.601.602.603.604.605.606.607.608.609.610.611.612.613.614.615.616.61" +
            "7.618.619.620.621.622.623.624.625.626.627.628.629.630.631.632.633.634.635.6" +
            "36.637.638.639.640.641.642.643.644.645.646.647.648.649.650.651.652.653.654." +
            "655.656.657.658.659.660.661.662.663.664.665.666.667.668.669.670.671.672.673" +
            ".674.675.676.677.678.679.680.681.682.683.684.685.686.687.688.689.690.691.69" +
            "2.693.694.695.696.697.698.699.700.701.702.703.704.705.706.707.708.709.710.7" +
            "11.712.713.714.715.716.717.718.719.720.721.722.723.724.725.726.727.728.729." +
            "730.731.732.733.734.735.736.737.738.739.740.741.742.743.744.745.746.747.748" +
            ".749.750.751.752.753.754.755.756.757.758.759.760.761.762.763.764.765.766.76" +
            "7.768.769.770.771.772.773.774.775.776.777.778.779.780.781.782.783.784.785.7" +
            "86.787.788.789.790.791.792.793.794.795.796.797.798.799.800.801.802.803.804." +
            "805.806.807.808.809.810.811.812.813.814.815.816.817.818.819.820.821.822.823" +
            ".824.825.826.827.828.829.830.831.832.833.834.835.836.837.838.839.840.841.84" +
            "2.843.844.845.846.847.848.849.850.851.852.853.854.855.856.857.858.859.860.8" +
            "61.862.863.864.865.866.867.868.869.870.871.872.873.874.875.876.877.878.879." +
            "880.881.882.883.884.885.886.887.888.889.890.891.892.893.894.895.896.897.898" +
            ".899.900.901.902.903.904.905.906.907.908.909.910.911.912.913.914.915.916.91" +
            "7.918.919.920.921.922.923.924.925.926.927.928.929.930.931.932.933.934.935.9" +
            "36.937.938.939.940.941.942.943.944.945.946.947.948.949.950.951.952.953.954." +
            "955.956.957.958.959.960.961.962.963.964.965.966.967.968.969.970.971.972.973" +
            ".974.975.976.977.978.979.980.981.982.983.984.985.986.987.988.989.990.991.99" +
            "2.993.994.995.996.997.998.999.1000.";
    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();

    private final PrintStream originalOut = System.out;

    @BeforeEach
    void setUp() {
        System.setOut(new PrintStream(outContent));
    }

    @AfterEach
    public void restoreStreams() {
        System.setOut(originalOut);
    }

    @Test
    void when_commandIsCalledWithoutArguments_expect_print1to1000() throws InvalidArgumentsException {
        final PrintNumbersCommand command = new PrintNumbersCommand();
        command.call("");
        assertEquals(EXPECTED_PRINT_WITHOUT_ARGS, this.outContent.toString());
    }

    @Test
    void when_commandIsCalled_expect_invalidFormatException() {
        final PrintNumbersCommand command = new PrintNumbersCommand();

        assertThrows(InvalidArgumentsException.class
                , () -> command.call("-a"));
    }

    @Test
    void when_commandIsCallendWithEvenFlag_expect_doesNotThrowException() {
        final PrintNumbersCommand command = new PrintNumbersCommand();

        assertDoesNotThrow(() -> command.call("-e"));
    }

    @Test
    void when_commandIsCalledWithEvenFlag_expect_print1to1000OddValues() throws InvalidArgumentsException {
        final PrintNumbersCommand command = new PrintNumbersCommand();
        command.call("-e");

        assertEquals(ODD_STRING_VALUES, this.outContent.toString());
    }

    @Test
    void when_commandIsCalledWithOddFlag_expect_print1to1000EvenValues() throws InvalidArgumentsException {
        final PrintNumbersCommand command = new PrintNumbersCommand();
        command.call("-o");

        assertEquals(EVEN_STRING_VALUES, this.outContent.toString());
    }

    @Test
    void when_commandIsCalledWithArgumentFirst_expect_print500to1000() throws InvalidArgumentsException {
        final PrintNumbersCommand command = new PrintNumbersCommand();
        command.call("-f 500");

        assertEquals(NUMBERS_500_TO_1000, this.outContent.toString());
    }

    @Test
    void when_commandIsCalledWithArgumentLast_expect_print1to30() throws InvalidArgumentsException {
        final PrintNumbersCommand command = new PrintNumbersCommand();
        command.call("-l 30");

        assertEquals(NUMBERS_1_TO_30, this.outContent.toString());
    }


    @Test
    void when_commandIsCalledWithArgumentLastAndFirst_expect_print20to30() throws InvalidArgumentsException {
        final PrintNumbersCommand command = new PrintNumbersCommand();
        command.call("-l 30 -f 20");

        assertEquals(NUMBERS_20_TO_30, this.outContent.toString());
    }


    @Test
    void when_commandIsCalledWithArgumentPrefix_expect_printNumbersWithPrefix() throws InvalidArgumentsException {
        final PrintNumbersCommand command = new PrintNumbersCommand();
        command.call("-p .");

        assertEquals(NUMBERS_1_TO_1000_WITH_PREFIX, this.outContent.toString());
    }

    @Test
    void when_commandIsCalledWithArgumentSuffix_expect_printNumbersWithSuffix() throws InvalidArgumentsException {
        final PrintNumbersCommand command = new PrintNumbersCommand();
        command.call("-s .");

        assertEquals(NUMBERS_1_TO_1000_WITH_SUFFIX, this.outContent.toString());
    }

    @Test
    void when_commandIsCalledWithAllArgumentsExpectOddFlag_expect_expectedString() throws InvalidArgumentsException {
        final PrintNumbersCommand command = new PrintNumbersCommand();
        command.call("-s . -p - -f 5 -l 10 -e");

        assertEquals("-5.-7.-9.", this.outContent.toString());
    }

    @Test
    void when_commandIsCalledWithAllArguments_expect_expectedString() throws InvalidArgumentsException {
        final PrintNumbersCommand command = new PrintNumbersCommand();
        command.call("-s . -p - -f 5 -l 10 -e -o");

        assertEquals("", this.outContent.toString());
    }


}